# 本项目开发准则

欢迎为本项目贡献代码！为了确保所有脚本的质量、可靠性和安全性，任何处理用户文件的脚本都必须严格遵守以下五条核心准则。

---

### 准则一：最完整的元数据保留 (Complete Metadata Preservation)

文件不仅仅包含可见的数据，更携带着描述其自身的宝贵信息（元数据）。我们的目标是，在任何转换或处理过程中，都不能丢失这些信息。

- **实现方式**:
    - **内部元数据**: 对于图片、视频等文件，必须使用如 `exiftool` 这样的专业工具，在处理完成后，通过 `-tagsfromfile` 命令从源文件向目标文件进行一次完整的元数据迁移。这包括但不限于 EXIF, IPTC, XMP, GPS 等所有可读写的标签。
    - **系统元数据**: 必须使用 `touch -r <源文件> <目标文件>` 命令，将源文件的文件系统时间戳（特别是修改日期）精确地复制到目标文件。

### 准则二：简易安全功能与响亮报错 (Robust Safety & Loud Errors)

用户的系统安全是第一位的。绝不能因为脚本的误用而导致灾难性后果。

- **实现方式**:
    - **危险目录检查**: 脚本必须内置一个“危险目录”列表（如 `/`, `/System`, `/usr`, 用户主目录 `~` 等）。
    - **触发条件**: 当且仅当一个具有破坏性的操作（见准则四）被激活时，此安全检查才会被触发。
    - **响亮报错**: 如果目标目录位于危险目录之内，脚本**必须**立即退出，并打印出非常醒目、清晰、易于理解的错误信息，明确告知用户为何操作被禁止。

### 准则三：批量处理能力 (Batch Processing Capability)

所有脚本都应该被设计为能高效处理大量文件，而非一次只能处理一个。

- **实现方式**:
    - 脚本的主要输入参数应该是一个目录路径。
    - 必须使用 `find` 命令并配合 `-print0` 和 `while read -r -d $'\0'` 循环来安全、递归地遍历目录下的所有目标文件。这种方式可以完美处理文件名中包含空格或特殊字符的情况。

### 准则四：明确的原地替换功能 (Explicit In-Place Replacement)

直接修改或删除用户的原始文件是危险操作，绝不能作为默认行为。用户必须明确表示他们希望这样做。

- **实现方式**:
    - **可选标志**: 任何原地替换、删除源文件或其它破坏性操作，都**必须**隐藏在一个可选的命令行标志之后（例如 `--in-place` 或 `--delete-source`）。
    - **默认行为**: 在不提供任何标志的情况下，脚本的默认行为应该是安全的、非破坏性的（例如，在旁边创建新文件）。

### 准则五：多次验证后的“安全删除” (Verified Safe Deletes)

只有在确认所有步骤都成功完成后，才能执行删除或替换原始文件的操作。

- **实现方式**:
    - **检查退出码**: 在执行核心操作（如 `ffmpeg`, `cjxl` 转换）后，必须立刻检查其退出码 (`$?`)。如果退出码非零，则必须中止后续操作，并报告错误。
    - **操作顺序**: 对于原地替换，正确的、经过验证的顺序是：
        1.  转换到**临时文件**。
        2.  验证转换是否成功（检查退出码）。
        3.  将元数据和时间戳从原始文件复制到临时文件。
        4.  **全部成功后**，才可删除原始文件，并将临时文件重命名。

---
所有新的贡献都将被依据以上准则进行评估。
