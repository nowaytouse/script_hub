#!name=Reddit å»å¹¿å‘Š
#!group (for organization): ã€ ğŸ¯ Narrow Pierce â€º çª„åŸŸç©¿åˆº ã€
#!desc=è¿‡æ»¤æ¨å¹¿, å…³ NSFW æç¤º, è‡ªåŠ¨å¼€å¯ç¿»è¯‘(JQ ç‰ˆ)
#!category (Surge only): xream
#!arguments=NSFW:"Nsfw",TRANSLATION:"http-request"
#!arguments-desc=\n1ï¸âƒ£ NSFW\n\nå¡«å†™ Nsfw æ—¶, è¡¨ç¤ºå…³é—­ NSFW æç¤º, å…¶ä»–å€¼è¡¨ç¤ºæ¢å¤é»˜è®¤è¡Œä¸º\n\n2ï¸âƒ£ TRANSLATION\n\nå¡«å†™ http-request æ—¶, è¡¨ç¤ºå¼€å¯è‡ªåŠ¨ç¿»è¯‘, # è¡¨ç¤ºå…³é—­è‡ªåŠ¨ç¿»è¯‘.\nâš ï¸ ç”±äºæ— æ³•åŒºåˆ†é¦–æ¬¡åŸå§‹è¯·æ±‚å’Œæ‰‹åŠ¨ç‚¹å‡»ç¿»è¯‘çš„è¯·æ±‚, å¼€å¯ä¹‹å App å†…åˆ‡æ¢åŠŸèƒ½å°±æ— æ•ˆäº†...

[General]

force-http-engine-hosts = %APPEND% gql.reddit.com, gql-fed.reddit.com

[MITM]

hostname = %APPEND%, gql.reddit.com, gql-fed.reddit.com

[Body Rewrite]

# walk(
#   if type == "object" then
#     (if .is{{{NSFW}}} == true then .is{{{NSFW}}} = false else . end)
#     | (if .is{{{NSFW}}}MediaBlocked == true then .is{{{NSFW}}}MediaBlocked = false else . end)
#     | (if .is{{{NSFW}}}ContentShown == false then .is{{{NSFW}}}ContentShown = true else . end)
#     | (if (.commentsPageAds | type == "array") then (.commentsPageAds = []) else . end)
#     | (if ( (.node | type == "object") and (.node.cells | type == "array") and (.node.cells | any(.__typename? == "AdMetadataCell" or .isAdPost? == true)) ) then empty else . end)
#     | (if (.node | type == "object") and (.node.adPayload | type == "object") then empty else . end)
#     | (if .__typename == "AdPost" then empty else . end)
#   else . 
# end)

http-response-jq ^https?:\/\/gql(-fed)?\.reddit\.com 'walk( if type == "object" then (if .is{{{NSFW}}} == true then .is{{{NSFW}}} = false else . end) | (if .is{{{NSFW}}}MediaBlocked == true then .is{{{NSFW}}}MediaBlocked = false else . end) | (if .is{{{NSFW}}}ContentShown == false then .is{{{NSFW}}}ContentShown = true else . end) | (if (.commentsPageAds | type == "array") then (.commentsPageAds = []) else . end) | (if ( (.node | type == "object") and (.node.cells | type == "array") and (.node.cells | any(.__typename? == "AdMetadataCell" or .isAdPost? == true)) ) then empty else . end) | (if (.node | type == "object") and (.node.adPayload | type == "object") then empty else . end) | (if .__typename == "AdPost" then empty else . end) else . end)'

[Header Rewrite]
{{{TRANSLATION}}} ^https:\/\/gql-fed\.reddit\.com\/ header-del x-reddit-translations
{{{TRANSLATION}}} ^https:\/\/gql-fed\.reddit\.com\/ header-add x-reddit-translations "enabled"